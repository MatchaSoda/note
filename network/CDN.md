# CDN
### 什么是CDN
CDN的全称是Content Delivery Network，即**内容分发网络**。  
类似于快递在全国有多个仓库就近发货，网站也可以预先把内容分发至全国各地的加速节点，这样用户就可以就近获取所需内容，避免网络拥堵、地域、运营商等因素带来的访问延迟问题，有效提升下载速度、降低响应时间，提供流畅的用户体验。
### CDN工作流程
#### 传统流程
* 用户在自己的浏览器中输入要访问的网站域名。
* 浏览器向本地DNS服务器请求对该域名的解析。
* 本地DNS服务器中如果缓存有这个域名的解析结果，则直接响应用户的解析请求。
* 本地DNS服务器中如果没有关于这个域名的解析结果的缓存，则以迭代方式向整个DNS系统请求解析，获得应答后将结果反馈给浏览器。
* 浏览器得到域名解析结果，就是该域名相应的服务设备的IP地址 。
* 浏览器获取IP地址之后，经过标准的TCP握手流程，建立TCP连接。
* 浏览器向服务器发起HTTP请求。
* 服务器将用户请求内容传送给浏览器。
* 经过标准的TCP挥手流程，断开TCP连接。
#### 引入CDN后
* 当用户点击网站页面上的内容URL，先经过本地DNS系统解析，如果本地DNS服务器没有相应域名的缓存，则本地DNS系统会将域名的解析权交给CNAME指向的**CDN专用DNS服务器**。
* CDN的DNS服务器将CDN的**全局负载均衡设备**的IP地址返回给用户。
* 用户向CDN的全局负载均衡设备发起URL访问请求。
* CDN全局负载均衡设备根据用户IP地址，以及用户请求的URL，选择一台用户所属区域的**区域负载均衡设备**，并将请求**转发**到此设备上。
* 基于以下这些条件的综合分析之后，区域负载均衡设备会选择一个最优的**缓存服务器节点**，并从缓存服务器节点处得到缓存服务器的IP地址，最终将得到的IP地址**返回**给全局负载均衡设备：  
①根据用户IP地址，判断哪一个边缘节点距用户最近；  
②根据用户所请求的URL中携带的内容名称，判断哪一个边缘节点上有用户所需内容；  
③查询各个边缘节点当前的负载情况，判断哪一个边缘节点尚有服务能力。
全局负载均衡设备把服务器的IP地址返回给用户。  
* 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。
### CDN的组成
#### 中心节点
中心节点包括CDN网管中心和全局负载均衡DNS重定向解析系统，负责整个CDN网络的分发及管理。
#### 边缘节点
CDN边缘节点主要指异地分发节点，由负载均衡设备、高速缓存服务器两部分组成。  
**负载均衡设备**负责每个节点中各个Cache的负载均衡，保证节点的工作效率；同时还负责收集节点与周围环境的信息，保持与全局负载均衡DNS的通信，实现整个系统的负载均衡。  
**高速缓存服务器**（Cache）负责存储客户网站的大量信息，就像一个靠近用户的网站服务器一样响应本地用户的访问请求。通过全局负载均衡DNS的控制，用户的请求被透明地指向离他最近的节点，节点中Cache服务器就像网站的原始服务器一样，响应终端用户的请求。因其距离用户更近，故其响应时间才更快。